<!DOCTYPE html>
<html>
<head>
    <title>Push Notification Debug</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Push Notification Diagnostic</h1>
    <button id="requestPermission">üîî Request Notification Permission</button>
    <button id="checkStatus">Check Notification Status</button>
    <button id="testWeb">Test Web Notification</button>
    <button id="checkSW">Check Service Worker</button>
    
    <div id="results" style="margin-top: 20px; font-family: monospace; white-space: pre-line;"></div>

    <script>
        const results = document.getElementById('results');
        
        function log(message) {
            results.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }
        
        document.getElementById('requestPermission').onclick = async function() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                log('üîî Permission request result: ' + permission);
                
                if (permission === 'granted') {
                    log('‚úÖ Notifications are now enabled!');
                } else {
                    log('‚ùå Notification permission denied. Please check browser settings.');
                }
            } else {
                log('‚ùå This browser does not support notifications');
            }
        };
        
        document.getElementById('checkStatus').onclick = async function() {
            results.textContent = '';
            
            // Check notification permission
            log('üîç Notification permission: ' + Notification.permission);
            
            // Check if browser supports notifications
            log('üîç Browser supports notifications: ' + ('Notification' in window));
            
            // Check if browser supports service workers
            log('üîç Browser supports service workers: ' + ('serviceWorker' in navigator));
            
            // Check if push is supported
            log('üîç Browser supports push: ' + ('PushManager' in window));
            
            // Check service worker registration
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration('/');
                    log('üîç Service worker registered: ' + !!registration);
                    if (registration) {
                        log('üîç Service worker scope: ' + registration.scope);
                        log('üîç Service worker state: ' + (registration.active ? registration.active.state : 'none'));
                    }
                } catch (error) {
                    log('‚ùå Service worker error: ' + error.message);
                }
            }
        };
        
        document.getElementById('testWeb').onclick = function() {
            if (Notification.permission === 'granted') {
                const notification = new Notification('üß™ Test Web Notification', {
                    body: 'If you see this, web notifications are working!',
                    icon: '/logo192.png',
                    tag: 'test-web'
                });
                
                notification.onclick = function() {
                    log('‚úÖ Web notification clicked');
                    notification.close();
                };
                
                log('üì± Web notification sent');
            } else {
                log('‚ùå Notification permission not granted');
            }
        };
        
        document.getElementById('checkSW').onclick = async function() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    log('‚úÖ Service worker registered successfully');
                    
                    // Wait for it to be ready
                    await navigator.serviceWorker.ready;
                    log('‚úÖ Service worker is ready');
                    
                } catch (error) {
                    log('‚ùå Service worker registration failed: ' + error.message);
                }
            }
        };
    </script>
</body>
</html>